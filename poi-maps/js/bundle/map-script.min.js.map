{"version":3,"sources":["../map-script.js"],"names":["jQuery","document","ready","$","map","L","Map","center","LatLng","zoom","Stamen_Toner","tileLayer","attribution","subdomains","minZoom","maxZoom","ext","addLayer","district_boundary","geoJson","addTo","ajax","dataType","url","success","data","features","each","key","addData","error","console","on","e","addMarker","latlng","mapMarker","val","latLng","lat","lng","noResults","undefined","removeLayer","poiMap","mapIcon","icon","iconUrl","iconSize","marker","updateInputs","processLocationData","results","locations","adminArea1","toLowerCase","alert","address","log","ajaxurl","post","location","JSON","parse","fail","response","responseText","statusText"],"mappings":"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","file":"map-script.min.js","sourcesContent":["\njQuery(document).ready(function ($) {\n  var map = new L.Map(\"leafletMap\", {\n    center: new L.LatLng(61.6914766, 27.259305),\n    zoom: 12\n  });\n\n  var Stamen_Toner = L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}.{ext}', {\n    attribution: 'Map tiles by <a href=\"http://stamen.com\">Stamen Design</a>, <a href=\"http://creativecommons.org/licenses/by/3.0\">CC BY 3.0</a> &mdash; Map data &copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\n    subdomains: 'abcd',\n    minZoom: 0,\n    maxZoom: 20,\n    ext: 'png'\n  });\n  map.addLayer(Stamen_Toner);\n\n  var district_boundary = new L.geoJson();\n  district_boundary.addTo(map);\n\n  $.ajax({\n  dataType: \"json\",\n  url: \"https://gist.githubusercontent.com/VilleKoivukangas/77b78e6925b336744790e74c4578309c/raw/2d46daec1a99b88f8d2f2e11d27fc824968e05c4/powerline.json\",\n  success: function(data) {\n    $(data.features).each(function(key, data) {\n      district_boundary.addData(data);\n    });\n  }\n  }).error(function() {\n    console.error(\"Failed to get powerlines geoJSON\");\n  });\n\n  map.on('click', function (e) {\n    addMarker(e.latlng);\n  });\n  \n  let mapMarker = {};\n  if ($('input[name=\"poi_lat\"]').val() && $('input[name=\"poi_lng\"]').val()) {\n    var latLng = {\n      lat: $('input[name=\"poi_lat\"]').val(),\n      lng:  $('input[name=\"poi_lng\"]').val()\n    };\n    addMarker(latLng);\n  }\n\n  function addMarker(latLng) {\n    if (!latLng) {\n      noResults();\n      return;\n    }\n\n    if (mapMarker != undefined) {\n      map.removeLayer(mapMarker);\n    }\n\n    if (poiMap.mapIcon) {\n      var icon = L.icon({iconUrl: poiMap.mapIcon, iconSize: [50, 50]});\n      mapMarker = L.marker([latLng.lat, latLng.lng], {icon: icon});\n    } else {\n      mapMarker = L.marker([latLng.lat, latLng.lng]);\n    }\n    \n    mapMarker.addTo(map);\n    updateInputs(latLng);\n  }\n\n  function processLocationData(data) {\n    if (data.results && data.results[0].locations && data.results[0].locations[0] && data.results[0].locations[0].latLng) {\n      if (data.results[0].locations[0].adminArea1.toLowerCase() != \"fi\") {\n        alert(\"Added marker to country: \" + data.results[0].locations[0].adminArea1 + \". If this isn't right you can add marker manually by clicking the map and then you can write the addres to the address input.\");\n      }\n\n      const latLng = data.results[0].locations[0].latLng;\n      addMarker(latLng);\n      updateInputs(latLng);\n    } else {\n      noResults();\n    }\n  }\n\n  function updateInputs (latLng) {\n    $('input[name=\"poi_lat\"]').val(latLng.lat);\n    $('input[name=\"poi_lng\"]').val(latLng.lng);\n  }\n\n  function noResults () {\n    alert(\"No results found. You can add your location manually by clicking the map to add marker and writing the address to text input.\");\n  }\n\n  $(document).on(\"click\", \"#searchAddressButton\", () => {\n    const address = $(\"#addressInput\").val();\n\n    if (!address) {\n      return;\n    }\n    console.log(poiMap.ajaxurl);\n    $.post(poiMap.ajaxurl, {\n      'action': 'geocode',\n      'data': { location: address }\n    }, (data) => {\n      if (!data) {\n        noResults();\n        return;\n      }\n\n      console.log(data);\n      processLocationData(JSON.parse(data));\n    }).fail(function (response) {\n      console.log(response.responseText || response.statusText || 'Unknown error occurred');\n    });\n  });\n});"]}